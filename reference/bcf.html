<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Run the Bayesian Causal Forest (BCF) algorithm for regularized causal effect estimation. — bcf • stochtree</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Run the Bayesian Causal Forest (BCF) algorithm for regularized causal effect estimation. — bcf"><meta property="og:description" content="Run the Bayesian Causal Forest (BCF) algorithm for regularized causal effect estimation."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stochtree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/BayesianSupervisedLearning.html">Bayesian Supervised Learning in StochTree</a>
    </li>
    <li>
      <a href="../articles/CausalInference.html">Causal Machine Learning in StochTree</a>
    </li>
    <li>
      <a href="../articles/CustomSamplingRoutine.html">Custom Sampling Routines in StochTree</a>
    </li>
    <li>
      <a href="../articles/EnsembleKernel.html">Kernel Methods from Tree Ensembles in StochTree</a>
    </li>
    <li>
      <a href="../articles/ModelSerialization.html">Model Serialization in StochTree</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Run the Bayesian Causal Forest (BCF) algorithm for regularized causal effect estimation.</h1>
    
    <div class="hidden name"><code>bcf.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Run the Bayesian Causal Forest (BCF) algorithm for regularized causal effect estimation.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bcf</span><span class="op">(</span></span>
<span>  <span class="va">X_train</span>,</span>
<span>  <span class="va">Z_train</span>,</span>
<span>  <span class="va">y_train</span>,</span>
<span>  pi_train <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group_ids_train <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rfx_basis_train <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  X_test <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Z_test <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pi_test <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group_ids_test <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rfx_basis_test <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cutpoint_grid_size <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  sigma_leaf_mu <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sigma_leaf_tau <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alpha_mu <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  alpha_tau <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  beta_mu <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  beta_tau <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  min_samples_leaf_mu <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  min_samples_leaf_tau <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  nu <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  lambda <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  a_leaf_mu <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  a_leaf_tau <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  b_leaf_mu <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  b_leaf_tau <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  q <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  sigma2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  variable_weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  keep_vars_mu <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  drop_vars_mu <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  keep_vars_tau <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  drop_vars_tau <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num_trees_mu <span class="op">=</span> <span class="fl">250</span>,</span>
<span>  num_trees_tau <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  num_gfr <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  num_burnin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  num_mcmc <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  sample_sigma_global <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  sample_sigma_leaf_mu <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  sample_sigma_leaf_tau <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  propensity_covariate <span class="op">=</span> <span class="st">"mu"</span>,</span>
<span>  adaptive_coding <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  b_0 <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,</span>
<span>  b_1 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  random_seed <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  keep_burnin <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  keep_gfr <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>X_train</dt>
<dd><p>Covariates used to split trees in the ensemble. May be provided either as a dataframe or a matrix.
Matrix covariates will be assumed to be all numeric. Covariates passed as a dataframe will be
preprocessed based on the variable types (e.g. categorical columns stored as unordered factors will be one-hot encoded,
categorical columns stored as ordered factors will passed as integers to the core algorithm, along with the metadata
that the column is ordered categorical).</p></dd>


<dt>Z_train</dt>
<dd><p>Vector of (continuous or binary) treatment assignments.</p></dd>


<dt>y_train</dt>
<dd><p>Outcome to be modeled by the ensemble.</p></dd>


<dt>pi_train</dt>
<dd><p>(Optional) Vector of propensity scores. If not provided, this will be estimated from the data.</p></dd>


<dt>group_ids_train</dt>
<dd><p>(Optional) Group labels used for an additive random effects model.</p></dd>


<dt>rfx_basis_train</dt>
<dd><p>(Optional) Basis for "random-slope" regression in an additive random effects model.
If <code>group_ids_train</code> is provided with a regression basis, an intercept-only random effects model
will be estimated.</p></dd>


<dt>X_test</dt>
<dd><p>(Optional) Test set of covariates used to define "out of sample" evaluation data.
May be provided either as a dataframe or a matrix, but the format of <code>X_test</code> must be consistent with
that of <code>X_train</code>.</p></dd>


<dt>Z_test</dt>
<dd><p>(Optional) Test set of (continuous or binary) treatment assignments.</p></dd>


<dt>pi_test</dt>
<dd><p>(Optional) Vector of propensity scores. If not provided, this will be estimated from the data.</p></dd>


<dt>group_ids_test</dt>
<dd><p>(Optional) Test set group labels used for an additive random effects model.
We do not currently support (but plan to in the near future), test set evaluation for group labels
that were not in the training set.</p></dd>


<dt>rfx_basis_test</dt>
<dd><p>(Optional) Test set basis for "random-slope" regression in additive random effects model.</p></dd>


<dt>cutpoint_grid_size</dt>
<dd><p>Maximum size of the "grid" of potential cutpoints to consider. Default: 100.</p></dd>


<dt>sigma_leaf_mu</dt>
<dd><p>Starting value of leaf node scale parameter for the prognostic forest. Calibrated internally as <code>2/num_trees_mu</code> if not set here.</p></dd>


<dt>sigma_leaf_tau</dt>
<dd><p>Starting value of leaf node scale parameter for the treatment effect forest. Calibrated internally as <code>1/num_trees_tau</code> if not set here.</p></dd>


<dt>alpha_mu</dt>
<dd><p>Prior probability of splitting for a tree of depth 0 for the prognostic forest. Tree split prior combines <code>alpha</code> and <code>beta</code> via <code>alpha*(1+node_depth)^-beta</code>. Default: 0.95.</p></dd>


<dt>alpha_tau</dt>
<dd><p>Prior probability of splitting for a tree of depth 0 for the treatment effect forest. Tree split prior combines <code>alpha</code> and <code>beta</code> via <code>alpha*(1+node_depth)^-beta</code>. Default: 0.25.</p></dd>


<dt>beta_mu</dt>
<dd><p>Exponent that decreases split probabilities for nodes of depth &gt; 0 for the prognostic forest. Tree split prior combines <code>alpha</code> and <code>beta</code> via <code>alpha*(1+node_depth)^-beta</code>. Default: 2.0.</p></dd>


<dt>beta_tau</dt>
<dd><p>Exponent that decreases split probabilities for nodes of depth &gt; 0 for the treatment effect forest. Tree split prior combines <code>alpha</code> and <code>beta</code> via <code>alpha*(1+node_depth)^-beta</code>. Default: 3.0.</p></dd>


<dt>min_samples_leaf_mu</dt>
<dd><p>Minimum allowable size of a leaf, in terms of training samples, for the prognostic forest. Default: 5.</p></dd>


<dt>min_samples_leaf_tau</dt>
<dd><p>Minimum allowable size of a leaf, in terms of training samples, for the treatment effect forest. Default: 5.</p></dd>


<dt>nu</dt>
<dd><p>Shape parameter in the <code>IG(nu, nu*lambda)</code> global error variance model. Default: 3.</p></dd>


<dt>lambda</dt>
<dd><p>Component of the scale parameter in the <code>IG(nu, nu*lambda)</code> global error variance prior. If not specified, this is calibrated as in Sparapani et al (2021).</p></dd>


<dt>a_leaf_mu</dt>
<dd><p>Shape parameter in the <code>IG(a_leaf, b_leaf)</code> leaf node parameter variance model for the prognostic forest. Default: 3.</p></dd>


<dt>a_leaf_tau</dt>
<dd><p>Shape parameter in the <code>IG(a_leaf, b_leaf)</code> leaf node parameter variance model for the treatment effect forest. Default: 3.</p></dd>


<dt>b_leaf_mu</dt>
<dd><p>Scale parameter in the <code>IG(a_leaf, b_leaf)</code> leaf node parameter variance model for the prognostic forest. Calibrated internally as 0.5/num_trees if not set here.</p></dd>


<dt>b_leaf_tau</dt>
<dd><p>Scale parameter in the <code>IG(a_leaf, b_leaf)</code> leaf node parameter variance model for the treatment effect forest. Calibrated internally as 0.5/num_trees if not set here.</p></dd>


<dt>q</dt>
<dd><p>Quantile used to calibrated <code>lambda</code> as in Sparapani et al (2021). Default: 0.9.</p></dd>


<dt>sigma2</dt>
<dd><p>Starting value of global variance parameter. Calibrated internally as in Sparapani et al (2021) if not set here.</p></dd>


<dt>variable_weights</dt>
<dd><p>Numeric weights reflecting the relative probability of splitting on each variable. Does not need to sum to 1 but cannot be negative. Defaults to <code>rep(1/ncol(X_train), ncol(X_train))</code> if not set here. Note that if the propensity score is included as a covariate in either forest, its weight will default to <code>1/ncol(X_train)</code>. A workaround if you wish to provide a custom weight for the propensity score is to include it as a column in <code>X_train</code> and then set <code>propensity_covariate</code> to <code>'none'</code> adjust <code>keep_vars_mu</code> and <code>keep_vars_tau</code> accordingly.</p></dd>


<dt>keep_vars_mu</dt>
<dd><p>Vector of variable names or column indices denoting variables that should be included in the prognostic (<code>mu(X)</code>) forest. Default: NULL.</p></dd>


<dt>drop_vars_mu</dt>
<dd><p>Vector of variable names or column indices denoting variables that should be excluded from the prognostic (<code>mu(X)</code>) forest. Default: NULL. If both <code>drop_vars_mu</code> and <code>keep_vars_mu</code> are set, <code>drop_vars_mu</code> will be ignored.</p></dd>


<dt>keep_vars_tau</dt>
<dd><p>Vector of variable names or column indices denoting variables that should be included in the treatment effect (<code>tau(X)</code>) forest. Default: NULL.</p></dd>


<dt>drop_vars_tau</dt>
<dd><p>Vector of variable names or column indices denoting variables that should be excluded from the treatment effect (<code>tau(X)</code>) forest. Default: NULL. If both <code>drop_vars_tau</code> and <code>keep_vars_tau</code> are set, <code>drop_vars_tau</code> will be ignored.</p></dd>


<dt>num_trees_mu</dt>
<dd><p>Number of trees in the prognostic forest. Default: 200.</p></dd>


<dt>num_trees_tau</dt>
<dd><p>Number of trees in the treatment effect forest. Default: 50.</p></dd>


<dt>num_gfr</dt>
<dd><p>Number of "warm-start" iterations run using the grow-from-root algorithm (He and Hahn, 2021). Default: 5.</p></dd>


<dt>num_burnin</dt>
<dd><p>Number of "burn-in" iterations of the MCMC sampler. Default: 0.</p></dd>


<dt>num_mcmc</dt>
<dd><p>Number of "retained" iterations of the MCMC sampler. Default: 100.</p></dd>


<dt>sample_sigma_global</dt>
<dd><p>Whether or not to update the <code>sigma^2</code> global error variance parameter based on <code>IG(nu, nu*lambda)</code>. Default: T.</p></dd>


<dt>sample_sigma_leaf_mu</dt>
<dd><p>Whether or not to update the <code>sigma_leaf_mu</code> leaf scale variance parameter in the prognostic forest based on <code>IG(a_leaf_mu, b_leaf_mu)</code>. Default: T.</p></dd>


<dt>sample_sigma_leaf_tau</dt>
<dd><p>Whether or not to update the <code>sigma_leaf_tau</code> leaf scale variance parameter in the treatment effect forest based on <code>IG(a_leaf_tau, b_leaf_tau)</code>. Default: T.</p></dd>


<dt>propensity_covariate</dt>
<dd><p>Whether to include the propensity score as a covariate in either or both of the forests. Enter "none" for neither, "mu" for the prognostic forest, "tau" for the treatment forest, and "both" for both forests. If this is not "none" and a propensity score is not provided, it will be estimated from (<code>X_train</code>, <code>Z_train</code>) using <code><a href="bart.html">stochtree::bart()</a></code>. Default: "mu".</p></dd>


<dt>adaptive_coding</dt>
<dd><p>Whether or not to use an "adaptive coding" scheme in which a binary treatment variable is not coded manually as (0,1) or (-1,1) but learned via parameters <code>b_0</code> and <code>b_1</code> that attach to the outcome model <code>[b_0 (1-Z) + b_1 Z] tau(X)</code>. This is ignored when Z is not binary. Default: T.</p></dd>


<dt>b_0</dt>
<dd><p>Initial value of the "control" group coding parameter. This is ignored when Z is not binary. Default: -0.5.</p></dd>


<dt>b_1</dt>
<dd><p>Initial value of the "treatment" group coding parameter. This is ignored when Z is not binary. Default: 0.5.</p></dd>


<dt>random_seed</dt>
<dd><p>Integer parameterizing the C++ random number generator. If not specified, the C++ random number generator is seeded according to <code>std::random_device</code>.</p></dd>


<dt>keep_burnin</dt>
<dd><p>Whether or not "burnin" samples should be included in cached predictions. Default FALSE. Ignored if num_mcmc = 0.</p></dd>


<dt>keep_gfr</dt>
<dd><p>Whether or not "grow-from-root" samples should be included in cached predictions. Default FALSE. Ignored if num_mcmc = 0.</p></dd>


<dt>verbose</dt>
<dd><p>Whether or not to print progress during the sampling loops. Default: FALSE.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>List of sampling outputs and a wrapper around the sampled forests (which can be used for in-memory prediction on new data, or serialized to JSON on disk).</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>,<span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="va">n</span>,replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x1</span>,<span class="va">x2</span>,<span class="va">x3</span>,<span class="va">x4</span>,<span class="va">x5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">==</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">==</span><span class="fl">2</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">mu1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fl">1</span><span class="op">+</span><span class="fu">g</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">+</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">mu2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fl">1</span><span class="op">+</span><span class="fu">g</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">+</span><span class="fl">6</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">tau1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">tau2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fl">1</span><span class="op">+</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">x</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">mu_x</span> <span class="op">&lt;-</span> <span class="fu">mu1</span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tau_x</span> <span class="op">&lt;-</span> <span class="fu">tau2</span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pi_x</span> <span class="op">&lt;-</span> <span class="fl">0.8</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="va">mu_x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">mu_x</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.05</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>,<span class="fl">1</span>,<span class="va">pi_x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">E_XZ</span> <span class="op">&lt;-</span> <span class="va">mu_x</span> <span class="op">+</span> <span class="va">Z</span><span class="op">*</span><span class="va">tau_x</span></span></span>
<span class="r-in"><span><span class="va">snr</span> <span class="op">&lt;-</span> <span class="fl">4</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">E_XZ</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">E_XZ</span><span class="op">)</span><span class="op">/</span><span class="va">snr</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span><span class="op">$</span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">X</span><span class="op">$</span><span class="va">x4</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span><span class="op">$</span><span class="va">x5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">X</span><span class="op">$</span><span class="va">x5</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">test_set_pct</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span></span>
<span class="r-in"><span><span class="va">n_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">test_set_pct</span><span class="op">*</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n_train</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">-</span> <span class="va">n_test</span></span></span>
<span class="r-in"><span><span class="va">test_inds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="va">n_test</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">train_inds</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_inds</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">X_test</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="va">test_inds</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">X_train</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="va">train_inds</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">pi_test</span> <span class="op">&lt;-</span> <span class="va">pi_x</span><span class="op">[</span><span class="va">test_inds</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">pi_train</span> <span class="op">&lt;-</span> <span class="va">pi_x</span><span class="op">[</span><span class="va">train_inds</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">Z_test</span> <span class="op">&lt;-</span> <span class="va">Z</span><span class="op">[</span><span class="va">test_inds</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">Z_train</span> <span class="op">&lt;-</span> <span class="va">Z</span><span class="op">[</span><span class="va">train_inds</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">test_inds</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">train_inds</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">mu_test</span> <span class="op">&lt;-</span> <span class="va">mu_x</span><span class="op">[</span><span class="va">test_inds</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">mu_train</span> <span class="op">&lt;-</span> <span class="va">mu_x</span><span class="op">[</span><span class="va">train_inds</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">tau_test</span> <span class="op">&lt;-</span> <span class="va">tau_x</span><span class="op">[</span><span class="va">test_inds</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">tau_train</span> <span class="op">&lt;-</span> <span class="va">tau_x</span><span class="op">[</span><span class="va">train_inds</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">bcf_model</span> <span class="op">&lt;-</span> <span class="fu">bcf</span><span class="op">(</span>X_train <span class="op">=</span> <span class="va">X_train</span>, Z_train <span class="op">=</span> <span class="va">Z_train</span>, y_train <span class="op">=</span> <span class="va">y_train</span>, pi_train <span class="op">=</span> <span class="va">pi_train</span>, </span></span>
<span class="r-in"><span>                 X_test <span class="op">=</span> <span class="va">X_test</span>, Z_test <span class="op">=</span> <span class="va">Z_test</span>, pi_test <span class="op">=</span> <span class="va">pi_test</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># plot(rowMeans(bcf_model$mu_hat_test), mu_test, xlab = "predicted", ylab = "actual", main = "Prognostic function")</span></span></span>
<span class="r-in"><span><span class="co"># abline(0,1,col="red",lty=3,lwd=3)</span></span></span>
<span class="r-in"><span><span class="co"># plot(rowMeans(bcf_model$tau_hat_test), tau_test, xlab = "predicted", ylab = "actual", main = "Treatment effect")</span></span></span>
<span class="r-in"><span><span class="co"># abline(0,1,col="red",lty=3,lwd=3)</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Drew Herren, Richard Hahn, Jared Murray, Carlos Carvalho, Jingyu He.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

